# ===================== EXPORTS =====================
message("Step 5: Exports")

g_full            <- readRDS(file.path(output_dir, "editor_network_full_igraph.rds"))
g_gc              <- readRDS(file.path(output_dir, "editor_network_giant_igraph.rds"))
nodes_out         <- igraph::as_data_frame(g_gc, what = "vertices") %>% tibble::as_tibble()
edges_out         <- igraph::as_data_frame(g_gc, what = "edges")    %>% tibble::as_tibble()
editor_stats      <- readRDS(file.path(output_dir, "editor_stats_gc.rds"))
editor_stats_basic<- readRDS(file.path(output_dir, "editor_stats_basic_gc.rds"))
community_stats   <- readRDS(file.path(output_dir, "community_stats_gc.rds"))
net_stats_gc      <- readRDS(file.path(output_dir, "network_stats_gc.rds"))
mix_continent     <- readRDS(file.path(output_dir, "mixing_continent_gc.rds"))
mix_gender        <- readRDS(file.path(output_dir, "mixing_gender_gc.rds"))
assort_continent  <- readRDS(file.path(output_dir, "assortativity_continent_gc.rds"))
assort_gender     <- readRDS(file.path(output_dir, "assortativity_gender_gc.rds"))
cor_spear         <- readRDS(file.path(output_dir, "centrality_spearman_gc.rds"))
top30             <- readRDS(file.path(output_dir, "top30_editors_eci_gc.rds"))

# Save RDS bundles
saveRDS(nodes_out, file.path(output_dir, "editor_network_nodes_gc.rds"))
saveRDS(edges_out, file.path(output_dir, "editor_network_edges_gc.rds"))
saveRDS(editor_stats, file.path(output_dir, "editor_stats_gc.rds"))

# Combined RData
save(g_full, g_gc, nodes_out, edges_out, editor_stats_basic, editor_stats, community_stats, net_stats_gc,
     mix_continent, mix_gender, assort_continent, assort_gender,
     file = file.path(output_dir, "editor_network_bundle_gc.RData"))

# CSVs
readr::write_csv(nodes_out,        file.path(output_dir, "nodes_gc.csv"))
readr::write_csv(edges_out,        file.path(output_dir, "edges_gc.csv"))
readr::write_csv(editor_stats,     file.path(output_dir, "editor_stats_gc.csv"))
readr::write_csv(community_stats,  file.path(output_dir, "community_stats_gc.csv"))
readr::write_csv(net_stats_gc,     file.path(output_dir, "network_stats_gc.csv"))
readr::write_csv(mix_continent,    file.path(output_dir, "mixing_continent_gc.csv"))
readr::write_csv(mix_gender,       file.path(output_dir, "mixing_gender_gc.csv"))
readr::write_csv(tibble::as_tibble(cor_spear, rownames = "measure"),
                 file = file.path(output_dir, "centrality_spearman_gc.csv"))
readr::write_csv(top30, file.path(output_dir, "top30_editors_centrality_gc.csv"))

# Excel bundle
write_xlsx(
  list(
    "Network_Statistics_GC"   = net_stats_gc,
    "Editor_Statistics_GC"    = editor_stats,
    "Editor_Stats_Basic_GC"   = editor_stats_basic,
    "Community_Statistics_GC" = community_stats,
    "Mixing_Continent_GC"     = mix_continent,
    "Mixing_Gender_GC"        = mix_gender,
    "Nodes_GC"                = nodes_out,
    "Edges_GC"                = edges_out
  ),
  file.path(output_dir, "editor_network_results_gc.xlsx")
)

message("Exports done -> ", normalizePath(output_dir))
